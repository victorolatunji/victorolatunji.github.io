@page "/tax"
@using CanadianTaxCalculator.Data

@* ------------------------------------------------------------
   TaxCalculator.razor
   This Blazor component provides the user interface for the
   Canada-wide Provincial and Federal income tax calculator.
   It collects user input, invokes the TaxCalculator service,
   and displays computed results.
   ------------------------------------------------------------ *@

<h1>Canada Provincial Income Tax Calculator</h1>

<div class="mt-3">

    @* Input for taxable income *@
    <label>Taxable Income (CAD):</label><br />
    <input type="number" class="form-control" @bind="Income" />

    @* Dropdown list of Canadian provinces *@
    <label class="mt-3">Province:</label><br />
    <select class="form-control" @bind="SelectedProvince">
        @foreach (var p in Provinces)
        {
            <option value="@p">@p</option>
        }
    </select>

    @* Calculates tax when clicked *@
    <button class="btn btn-primary mt-3" @onclick="Calculate">Calculate</button>

</div>

@if (HasResult)
{
    <hr />
    <h3>Results</h3>

    <p><b>Federal Tax:</b> @FederalTax.ToString("C")</p>
    <p><b>Provincial Tax (@SelectedProvince):</b> @ProvincialTax.ToString("C")</p>
    <p><b>Total Tax:</b> @TotalTax.ToString("C")</p>
    <p><b>Effective Rate:</b> @EffectiveRate.ToString("N2")%</p>
}

@code {
    // Instance of the tax calculation engine
    private CanadianTaxCalculator.Data.TaxCalculator calc = new();

    // Exposes the province list from the TaxCalculator class
    private string[] Provinces => CanadianTaxCalculator.Data.TaxCalculator.ProvinceList;

    // Bound properties
    private decimal Income { get; set; }
    private string SelectedProvince { get; set; } = "Ontario";

    // Output data
    private decimal FederalTax, ProvincialTax, TotalTax, EffectiveRate;
    private bool HasResult = false;

    // ------------------------------------------------------------
    // Calculate()
    // This method invokes the TaxCalculator class and computes all
    // values required for display, including the effective tax rate.
    // ------------------------------------------------------------
    private void Calculate()
    {
        FederalTax = calc.CalculateFederalTax(Income);
        ProvincialTax = calc.CalculateProvincialTax(Income, SelectedProvince);
        TotalTax = FederalTax + ProvincialTax;
        EffectiveRate = Income > 0 ? (TotalTax / Income) * 100 : 0;
        HasResult = true;
    }
}
